<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>
    <head>
        <title>Apeiron - Admin Panel</title>
        <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
        <script type="text/javascript" src="/lib/jquery-2.0.1.min.js"></script>
        {% if edit_page %}
        <link rel="stylesheet" type="text/css" href="/lib/pagedown/editor.css" />
        <script type="text/javascript" src="/lib/pagedown/Markdown.Converter.js"></script>
        <script type="text/javascript" src="/lib/pagedown/Markdown.Sanitizer.js"></script>
        <script type="text/javascript" src="/lib/pagedown/Markdown.Editor.js"></script>
        {% endif %}
        <style>
            body
            {
                margin: 0px;
                background: #DDD;
                font-family: Lucida Sans Unicode, Lucida Grande, sans-serif;
            }

            #top_panel
            {
                background:
                linear-gradient(27deg, #151515 5px, transparent 5px) 0 5px,
                linear-gradient(207deg, #151515 5px, transparent 5px) 10px 0px,
                linear-gradient(27deg, #222 5px, transparent 5px) 0px 10px,
                linear-gradient(207deg, #222 5px, transparent 5px) 10px 5px,
                linear-gradient(90deg, #1b1b1b 10px, transparent 10px),
                linear-gradient(#1d1d1d 25%, #1a1a1a 25%, #1a1a1a 50%, transparent 50%, transparent 75%, #242424 75%, #242424);
                background-color: #131313;
                background-size: 20px 20px;

                text-align: center;

                
            }

            h1
            {
                color: #FFFFFF;
                font-size: 6em;
                font-weight: 100;
            }

            h2
            {
                margin-left: -10px;
                margin-bottom: 10px;
            }

            #login_box
            {
                background: #CCC;
                margin: 0px auto;
                width: 300px;
                height: 200px;
                margin-top: 5em;
                font-size: 15px;
                text-align: left;
                padding-left: 10%;
                color: #444;
                padding-top: 5%;
            }

            #inner_box
            {
                width: 185px;
            }

            #wrap
            {
                min-height: 100%;
            }

            *
            {
                margin:0;padding:0;
            } 

            html, body {height: 100%;}


            #main
            {
                overflow:auto;
                padding-bottom: 25px;
            }  

            #footer
            {
                position: relative;
                margin-top: -30px;
                height: 25px;
                clear:both;

                background:
                linear-gradient(27deg, #151515 5px, transparent 5px) 0 5px,
                linear-gradient(207deg, #151515 5px, transparent 5px) 10px 0px,
                linear-gradient(27deg, #222 5px, transparent 5px) 0px 10px,
                linear-gradient(207deg, #222 5px, transparent 5px) 10px 5px,
                linear-gradient(90deg, #1b1b1b 10px, transparent 10px),
                linear-gradient(#1d1d1d 25%, #1a1a1a 25%, #1a1a1a 50%, transparent 50%, transparent 75%, #242424 75%, #242424);
                background-color: #131313;
                background-size: 20px 20px;

                color: #FFFFFF;
                font-size: 10px;
                text-align: center;
                padding-top: 5px;
            } 

            body:before
            {
                content:"";
                height:100%;
                float:left;
                width:0;
                margin-top:-32767px;
            }

            #footer a 
            {
                color: #FFFFFF;
                text-decoration: none;
            }

            .genok
            {
                color: #336600;
                float: right;
            }

            .genpass
            {
                color: #6666FF;
                float: right;
            }

            input[type=text]
            {
                width: 180px;
            }

            input[type=password]
            {
                width: 180px;
            }

            input[type=submit]
            {
                padding-left: 10px;
                padding-right: 10px;
            }

            ul
            {
                list-style-type: square;
                padding-left: 25px;
                padding-bottom: 15px;
                padding-top: 2px;
            }

            #menu li
            {
                padding-bottom: 2px;
            }

            a
            {
                text-decoration: none;
                color: #333;
            }

            #main
            {
                margin: 0px auto;
                width: 1100px;
                font-size: 13px;
                overflow: hidden;
                position: relative;
            }

            #menu
            {
                width: 150px;
                padding: 25px;
                float: left;
            }

            #content
            {
                padding: 25px;
                background: #CCC;
                width: 850px;
                float: left;
                border-bottom: thick double #333;
            }

            #edit_page li:before {
                content: "|";
                padding-right: 5px;
            }

            .file_list
            {
                border-left: solid 1px #000;
                margin-left: 20px;
            }

            .file_list td
            {
                padding-left: 5px;
            }


            input[type=text]
            {
                background: #333;
                border: none;
                width: 250px;
                height: 22px;
                color: #EEE;
                font-size: 13px;
                font-family: "Lucida Console", Monaco, monospace;
                padding-left: 8px;
                outline: none;
            }

            input[type=submit]
            {
                background: #333;
                border: none;
                color: #EEE;
                padding: 10px;
                padding-left: 20px;
                padding-right: 20px;
                font-size: 13px;
                font-family: "Lucida Console", Monaco, monospace;
            }

            #login_box input[type=text], input[type=password]
            {
                background: #333;
                border: none;
                width: 176px;
                height: 22px;
                color: #EEE;
                font-size: 13px;
                font-family: "Lucida Console", Monaco, monospace;
                padding-left: 8px;
                outline: none;
            }


        </style>
    </head>
    <body>

        <div id="wrap">

            <div id="top_panel">
                <h1>admin panel</h1>
            </div>

            {% if notloggedin %}

            <div id="login_box">
                <div id="inner_box">
                    {% if invalid %}
                        <span style="color: #600;">Invalid login or password!</span>
                    {% endif %}

                    <form method="post">
                        <label for="login">Login: </label><br>
                        <input type="text" name="login"><br>

                        <label for="password">Password: </label><br>
                        <input type="password" name="password">
                        <p style="text-align: right; padding-top: 5px;">
                            <input type="submit" value="Login">
                        </p>
                    </form>

                </div>
            </div>

            {% endif %}

            {% if loggedin %}
            
            <div id="main">
                <div id="menu">
                    <b>Main:</b>
                    <ul>
                        <li>{% if dashboard %}<b>{% endif %}
                            <a href="/">Dashboard</a>
                        {% if dashboard %}</b>{% endif %}</li>
                        <li>{% if generator %}<b>{% endif %}
                            <a href="/generate/">Generate!</a>
                        {% if generator %}</b>{% endif %}</li>
                    </ul>
                    <b>Sections:</b>
                    <ul>
                        {% for section in sections %}
                            <li>{% if section_name == section %}<b>{% endif %}
                                <a href="/section/{{ section }}/">{{ section }}</a>
                                {% if section_name == section %}</b>{% endif %}</li>
                        {% endfor %}
                        <li><a href="/section/">new section</a></li>
                    </ul>
                    
                    <b>Settings:</b>
                    <ul>
                        <li>Config file</li>
                        <li><a href="/logout">Logout</a></li>
                    </ul>
                </div>
                <div id="content">


                    {% if dashboard %}
                        <h2>Dashboard</h2>

                        Summary:
                        <ul>
                            <li>Default section: {{ default_section }}</li>
                            <li>Number of sections: {{ sections|length }}</li>
                            <li>Default template: {{ default_template }}</li>
                            <li>Output directory: {{ output_directory }}</li>
                            <li>Static directory: {{ static_directory }}</li>
                            <li>Admin username: {{ admin_login }}</li>
                            <li>Change admin password</li>
                        </ul>

                        Sections:
                    {% endif %}


                    {% if edit_section %}
                        <h2>{{ section_name }}</h2>
                        <br>

                        <b>Actions:</b> Add new page | Select all | Remove selection | Inverse selection | Delete selected | Delete section<br><br>

                        <big>{{ section_name }}</big> ({{ section_pages|length }})<br>

                        {% if section_pages|length > 0 %}

                            <table class="file_list">
                                <tr style="color: #999;">
                                    <td style="width: 220px; padding-left: 20px;">Title</td>
                                    <td style="width: 150px;">Author</td>
                                    <td style="width: 120px;">Date</td>
                                    <td style="width: 220px;">Filename</td>
                                    <td style="width: 50px;">ID</td>
                                </tr>
                            {% for page in section_pages|sort %}
                                <tr>
                                    <td style="width: 220px;"><input type="checkbox"> <a href="{{ page }}/">{{ section_pages[page].Title }}</a></td>
                                    <td style="width: 150px;">{{ section_pages[page].Author }}</td>
                                    <td style="width: 120px;">{{ section_pages[page].Date }}</td>
                                    <td style="width: 220px;"><a href="{{ page }}/">{{ page }}.md</a></td>
                                    <td style="width: 50px;"><b>{{ section_pages[page].ID }}</td>
                                </tr>
                                
                            {% endfor %}

                            </table>

                            <div style="margin-left: 20px;">
                                &rarr; Add new page
                            </div>

                        {% else %}

                        That section is empty!

                        {% endif %}

                    {% endif %}

                    {% if edit_page %}
                        <h2>{{ page }}</h2>
                        File: input/{{ section_name }}/{{ page }}.md<br><br>

                        {% if save_success %}
                            <span class="genok">Page successfully saved!</span><br><br>
                        {% endif %}

                        <form method="post">

                            <table>
                                <tr>
                                    <td style="width: 60px;">
                                        Title:
                                    </td>
                                    <td>
                                        <input type="text" name="title">
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        Author:
                                    </td>
                                    <td>
                                        <input type="text" name="author">
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        Tags:
                                    </td>
                                    <td>
                                        <input type="text" name="tags">
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        Date:
                                    </td>
                                    <td>
                                        <input type="text" name="date">
                                    </td>
                                    <td>
                                        <input type="submit" value="Now" style="height: 22px; padding: 0px; width: 70px;">
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        ID:
                                    </td>
                                    <td>
                                       <input type="text" name="id">
                                    </td>
                                    <td>
                                        <input type="submit" value="Last" style="height: 22px; padding: 0px; width: 70px;">
                                    </td>
                                </tr>
                            </table>

                        <div class="wmd-panel">
                            <div id="wmd-button-bar-content"></div>
                            <textarea class="wmd-input" id="wmd-input-content" name="content">{{ contents }}</textarea>
                        </div>
                        <div id="wmd-preview-content" class="wmd-panel wmd-preview"></div>

                        <script type="text/javascript">
                            (function () {

                                var converter2 = new Markdown.Converter();
                                converter2.hooks.chain("preConversion", function (text) {
                                    return text.replace(/\b(a\w*)/gi, "*$1*");
                                });
                                converter2.hooks.chain("plainLinkText", function (url) {
                                    return "This is a link to " + url.replace(/^https?:\/\//, "");
                                });
                                var options = {
                                    strings: { quoteexample: "whatever you're quoting, put it right here" }
                                };
                                var editor2 = new Markdown.Editor(converter2, "-content", options);
                                
                                editor2.run();
                            })();
                        </script>
                        
                            <br>
                            <input type="submit" value="Save!" style="float: right; margin-left: 10px;">
                            <input type="submit" value="Save and generate!" style="float: right;">
                        </form>


                    {% endif %}

                    {% if generator %}

                    <h2>Generator output</h2>
                    <h3>Single pages:</h3>
                        <pre style="background: #333; margin: 30px; color: #DDD; padding: 25px;">
{% for item in pages_feedback -%}
{{ item.replace('OK', '<span class="genok">OK</span>').replace('PASS', '<span class="genpass">PASS</span>')|safe }}
{% endfor %}</pre>
                    <h3>Index pages:</h3>
                        <pre style="background: #333; margin: 30px; color: #DDD; padding: 25px;">
{% for item in index_feedback -%}
{% for subitem in item -%}
{{ subitem.replace('OK', '<span class="genok">OK</span>')|safe }}
{% endfor -%}
{% endfor -%}
                        </pre>

                    {% endif %}

                    {% if section_creator %}

                    <h2>Create new section</h2>

                    <br>

                    {{ section_message }}

                    <form method="post">
                        <label for="login">Section name:</label>
                        <input type="text" name="section" style="width: 250px;"><br>

                        <br>
                        <input type="submit" value="Create section">
                    </form>

                    {% endif %}

                </div>
            </div>

            {% endif %}
        </div>

        <div id="footer">
            <a href="https://github.com/solusipse/apeiron" target="_blank">Apeiron - static pages generator</a>
        </div>

    </body>
</html>